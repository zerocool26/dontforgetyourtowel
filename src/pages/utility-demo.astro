---
import MarketingLayout from '../layouts/MarketingLayout.astro';
import Card from '../components/ui/Card.astro';
import ModernButton from '../components/ui/ModernButton.astro';
import Animate from '../components/ui/Animate.astro';
import LegacyRedirect from '../components/LegacyRedirect.astro';

const title = 'Utility Library Demo';
const description =
  'Interactive demonstration of the built-in utility library including events, HTTP, accessibility, validation, and state management.';
---

<LegacyRedirect
  destination="/"
  reason="This page was part of the original starter template and has been removed."
/>

<!--
<MarketingLayout title={title} description={description}>
  <main class="container mx-auto px-4 py-12 max-w-6xl">
    <Animate animation="fade-in">
      <div class="text-center mb-12">
        <h1 class="text-4xl font-bold mb-4">Utility Library Demo</h1>
        <p class="text-lg text-zinc-400 max-w-2xl mx-auto">
          Explore our comprehensive utility library with interactive examples.
          All utilities are fully typed with TypeScript and tree-shakeable.
        </p>
      </div>
    </Animate>

    <div class="space-y-12">
      <!-- Events Section -->
<section>
  <Animate animation="slide-up">
    <h2 class="mb-6 flex items-center gap-3 text-2xl font-bold">
      <span
        class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-indigo-500/20 font-mono text-sm text-indigo-400"
        >01</span
      >
      Events & Keyboard Shortcuts
    </h2>
  </Animate>

  <div class="grid gap-6 md:grid-cols-2">
    <Card>
      <h3 class="mb-4 font-semibold">Keyboard Shortcuts</h3>
      <p class="mb-4 text-sm text-zinc-400">
        Press these keyboard shortcuts to see them in action:
      </p>
      <ul class="space-y-2 text-sm">
        <li class="flex items-center gap-2">
          <kbd class="rounded bg-zinc-800 px-2 py-1 text-xs">Ctrl/Cmd + K</kbd>
          <span class="text-zinc-400">Open Command Palette</span>
        </li>
        <li class="flex items-center gap-2">
          <kbd class="rounded bg-zinc-800 px-2 py-1 text-xs">Ctrl + M</kbd>
          <span class="text-zinc-400">Toggle Mobile Menu (on mobile)</span>
        </li>
        <li class="flex items-center gap-2">
          <kbd class="rounded bg-zinc-800 px-2 py-1 text-xs">Alt + 1</kbd>
          <span class="text-zinc-400">Skip to Main Content</span>
        </li>
        <li class="flex items-center gap-2">
          <kbd class="rounded bg-zinc-800 px-2 py-1 text-xs">Escape</kbd>
          <span class="text-zinc-400">Close Modals/Menus</span>
        </li>
      </ul>
      <div
        id="shortcut-display"
        class="mt-4 hidden rounded bg-zinc-800/50 p-3 font-mono text-sm"
      >
        Last shortcut: <span id="shortcut-text"></span>
      </div>
    </Card>

    <Card>
      <h3 class="mb-4 font-semibold">Event Emitter Demo</h3>
      <p class="mb-4 text-sm text-zinc-400">
        Type-safe event system with subscription management:
      </p>
      <div class="space-y-3">
        <ModernButton id="emit-event" variant="secondary" size="sm">
          Emit Custom Event
        </ModernButton>
        <div
          id="event-log"
          class="max-h-32 overflow-auto rounded bg-zinc-800/50 p-3 font-mono text-sm"
        >
          <p class="text-zinc-500">Event log will appear here...</p>
        </div>
      </div>
    </Card>
  </div>
</section>

<!-- Notifications Section -->
<section>
  <Animate animation="slide-up">
    <h2 class="mb-6 flex items-center gap-3 text-2xl font-bold">
      <span
        class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-green-500/20 font-mono text-sm text-green-400"
        >02</span
      >
      Notifications & Store
    </h2>
  </Animate>

  <Card>
    <h3 class="mb-4 font-semibold">Toast Notification System</h3>
    <p class="mb-4 text-sm text-zinc-400">
      Reactive notification system with auto-dismiss and screen reader support:
    </p>
    <div class="flex flex-wrap gap-3">
      <ModernButton id="notify-success" variant="primary" size="sm">
        Success Toast
      </ModernButton>
      <ModernButton id="notify-error" variant="secondary" size="sm">
        Error Toast
      </ModernButton>
      <ModernButton id="notify-warning" variant="secondary" size="sm">
        Warning Toast
      </ModernButton>
      <ModernButton id="notify-info" variant="secondary" size="sm">
        Info Toast
      </ModernButton>
    </div>
  </Card>
</section>

<!-- Accessibility Section -->
<section>
  <Animate animation="slide-up">
    <h2 class="mb-6 flex items-center gap-3 text-2xl font-bold">
      <span
        class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-purple-500/20 font-mono text-sm text-purple-400"
        >03</span
      >
      Accessibility Utilities
    </h2>
  </Animate>

  <div class="grid gap-6 md:grid-cols-2">
    <Card>
      <h3 class="mb-4 font-semibold">Screen Reader Announcements</h3>
      <p class="mb-4 text-sm text-zinc-400">
        ARIA live region announcements for dynamic content:
      </p>
      <div class="space-y-3">
        <ModernButton id="announce-polite" variant="secondary" size="sm">
          Polite Announcement
        </ModernButton>
        <ModernButton id="announce-assertive" variant="secondary" size="sm">
          Assertive Announcement
        </ModernButton>
        <p class="text-xs text-zinc-500">
          Enable a screen reader to hear the announcements
        </p>
      </div>
    </Card>

    <Card>
      <h3 class="mb-4 font-semibold">Focus Trap Demo</h3>
      <p class="mb-4 text-sm text-zinc-400">
        Tab key navigation is trapped within the highlighted area:
      </p>
      <div
        id="focus-trap-demo"
        class="space-y-3 rounded-lg border-2 border-dashed border-zinc-700 p-4"
      >
        <input
          type="text"
          aria-label="First input for focus trap demo"
          placeholder="First input"
          class="w-full rounded border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm"
        />
        <input
          type="text"
          aria-label="Second input for focus trap demo"
          placeholder="Second input"
          class="w-full rounded border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm"
        />
        <ModernButton
          id="toggle-focus-trap"
          variant="secondary"
          size="sm"
          className="w-full"
        >
          Toggle Focus Trap
        </ModernButton>
      </div>
    </Card>
  </div>
</section>

<!-- Media & Device Section -->
<section>
  <Animate animation="slide-up">
    <h2 class="mb-6 flex items-center gap-3 text-2xl font-bold">
      <span
        class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-orange-500/20 font-mono text-sm text-orange-400"
        >04</span
      >
      Media & Device Detection
    </h2>
  </Animate>

  <Card>
    <h3 class="mb-4 font-semibold">Device & Viewport Information</h3>
    <div id="device-info" class="grid gap-4 text-sm md:grid-cols-3">
      <div class="rounded bg-zinc-800/50 p-3">
        <p class="mb-1 text-xs text-zinc-500">Current Breakpoint</p>
        <p id="breakpoint" class="font-mono">Loading...</p>
      </div>
      <div class="rounded bg-zinc-800/50 p-3">
        <p class="mb-1 text-xs text-zinc-500">Viewport Size</p>
        <p id="viewport" class="font-mono">Loading...</p>
      </div>
      <div class="rounded bg-zinc-800/50 p-3">
        <p class="mb-1 text-xs text-zinc-500">Device Type</p>
        <p id="device-type" class="font-mono">Loading...</p>
      </div>
      <div class="rounded bg-zinc-800/50 p-3">
        <p class="mb-1 text-xs text-zinc-500">Touch Support</p>
        <p id="touch-support" class="font-mono">Loading...</p>
      </div>
      <div class="rounded bg-zinc-800/50 p-3">
        <p class="mb-1 text-xs text-zinc-500">Orientation</p>
        <p id="orientation" class="font-mono">Loading...</p>
      </div>
      <div class="rounded bg-zinc-800/50 p-3">
        <p class="mb-1 text-xs text-zinc-500">Color Scheme</p>
        <p id="color-scheme" class="font-mono">Loading...</p>
      </div>
    </div>
  </Card>
</section>

<!-- Validation Section -->
<section>
  <Animate animation="slide-up">
    <h2 class="mb-6 flex items-center gap-3 text-2xl font-bold">
      <span
        class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-cyan-500/20 font-mono text-sm text-cyan-400"
        >05</span
      >
      Validation Utilities
    </h2>
  </Animate>

  <Card>
    <h3 class="mb-4 font-semibold">Schema Validation with Zod</h3>
    <p class="mb-4 text-sm text-zinc-400">
      Real-time validation with detailed error messages:
    </p>
    <div class="space-y-4">
      <div>
        <label class="mb-1 block text-sm text-zinc-400">Email Validation</label>
        <input
          id="validate-email"
          type="text"
          placeholder="Enter an email address"
          class="w-full rounded border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm"
        />
        <p id="email-result" class="mt-1 text-xs"></p>
      </div>
      <div>
        <label class="mb-1 block text-sm text-zinc-400">Phone Validation</label>
        <input
          id="validate-phone"
          type="text"
          placeholder="Enter a phone number"
          class="w-full rounded border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm"
        />
        <p id="phone-result" class="mt-1 text-xs"></p>
      </div>
      <div>
        <label class="mb-1 block text-sm text-zinc-400">Password Strength</label
        >
        <input
          id="validate-password"
          type="password"
          placeholder="Enter a password"
          class="w-full rounded border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm"
        />
        <p id="password-result" class="mt-1 text-xs"></p>
      </div>
    </div>
  </Card>
</section>

<!-- Crypto Section -->
<section>
  <Animate animation="slide-up">
    <h2 class="mb-6 flex items-center gap-3 text-2xl font-bold">
      <span
        class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-red-500/20 font-mono text-sm text-red-400"
        >06</span
      >
      Crypto Utilities
    </h2>
  </Animate>

  <div class="grid gap-6 md:grid-cols-2">
    <Card>
      <h3 class="mb-4 font-semibold">UUID Generation</h3>
      <p class="mb-4 text-sm text-zinc-400">Generate unique identifiers:</p>
      <div class="space-y-3">
        <ModernButton id="generate-uuid" variant="secondary" size="sm">
          Generate UUID
        </ModernButton>
        <ModernButton id="generate-short-id" variant="secondary" size="sm">
          Generate Short ID
        </ModernButton>
        <div
          id="uuid-display"
          class="break-all rounded bg-zinc-800/50 p-3 font-mono text-sm"
        >
          Click a button to generate...
        </div>
      </div>
    </Card>

    <Card>
      <h3 class="mb-4 font-semibold">Hashing Demo</h3>
      <p class="mb-4 text-sm text-zinc-400">
        SHA-256 hashing with Web Crypto API:
      </p>
      <div class="space-y-3">
        <input
          id="hash-input"
          type="text"
          placeholder="Enter text to hash"
          class="w-full rounded border border-zinc-700 bg-zinc-800 px-3 py-2 text-sm"
        />
        <ModernButton
          id="hash-btn"
          variant="secondary"
          size="sm"
          className="w-full"
        >
          Generate Hash
        </ModernButton>
        <div
          id="hash-display"
          class="break-all rounded bg-zinc-800/50 p-3 font-mono text-sm text-zinc-400"
        >
          Hash will appear here...
        </div>
      </div>
    </Card>
  </div>
</section>

<!-- HTTP Section -->
<section>
  <Animate animation="slide-up">
    <h2 class="mb-6 flex items-center gap-3 text-2xl font-bold">
      <span
        class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-yellow-500/20 font-mono text-sm text-yellow-400"
        >07</span
      >
      HTTP Client
    </h2>
  </Animate>

  <Card>
    <h3 class="mb-4 font-semibold">Type-Safe HTTP Client</h3>
    <p class="mb-4 text-sm text-zinc-400">
      Feature-rich HTTP client with interceptors, retry logic, and more:
    </p>
    <div class="space-y-3">
      <ModernButton id="fetch-demo" variant="secondary" size="sm">
        Fetch Data Demo
      </ModernButton>
      <div
        id="http-result"
        class="max-h-40 overflow-auto rounded bg-zinc-800/50 p-3 font-mono text-sm"
      >
        Click button to fetch data...
      </div>
    </div>
  </Card>
</section>

<!-- Usage Code Section -->
<section>
  <Animate animation="slide-up">
    <h2 class="mb-6 flex items-center gap-3 text-2xl font-bold">
      <span
        class="inline-flex h-8 w-8 items-center justify-center rounded-lg bg-zinc-500/20 font-mono text-sm text-zinc-400"
        >08</span
      >
      Usage Examples
    </h2>
  </Animate>

  <Card>
    <h3 class="mb-4 font-semibold">Import and Use</h3>
    <pre
      class="overflow-x-auto rounded-lg bg-zinc-900 p-4 text-sm"><code class="text-green-400">{`// Import individual utilities
import { onKeyboardShortcut } from '@/utils/events';
import { createFocusTrap, announce } from '@/utils/a11y';
import { get, post } from '@/utils/http';
import { uuid, sha256 } from '@/utils/crypto';
import { emailSchema, phoneSchema } from '@/utils/validation';
import { getCurrentBreakpoint, isMobile } from '@/utils/media';

// Import store functions
import { notify, addNotification, theme, setTheme } from '@/store';

// Example: Register keyboard shortcut
onKeyboardShortcut({ key: 'k', ctrl: true }, () => {
  console.log('Ctrl+K pressed!');
});

// Example: Show notification
notify.success('Operation completed successfully!');

// Example: Validate email
const result = emailSchema.safeParse(email);
if (!result.success) {
  console.error(result.error.issues);
}`}</code></pre>
  </Card>
</section>

-->

<script>
  // Import our utilities to power the demo
  import { EventEmitter, onKeyboardShortcut } from '../utils/events';
  import { announce, createFocusTrap } from '../utils/a11y';
  import { notify } from '../store/index';
  import {
    getCurrentBreakpoint,
    getViewportSize,
    isMobile,
    hasTouch,
  } from '../utils/media';
  import {
    emailSchema,
    phoneSchema,
    passwordSchema,
  } from '../utils/validation';
  import { uuid, shortId, sha256 } from '../utils/crypto';
  import { get } from '../utils/http';

  // Keyboard shortcut display
  const shortcutDisplay = document.getElementById('shortcut-display');
  const shortcutText = document.getElementById('shortcut-text');

  onKeyboardShortcut({ key: 'k', ctrl: true }, () => {
    if (shortcutDisplay && shortcutText) {
      shortcutDisplay.classList.remove('hidden');
      shortcutText.textContent = 'Ctrl/Cmd + K';
    }
  });

  // Event Emitter Demo
  type DemoEvents = {
    click: { count: number };
    message: { text: string };
  };

  const emitter = new EventEmitter<DemoEvents>();
  const eventLog = document.getElementById('event-log');
  let clickCount = 0;

  emitter.on('click', data => {
    if (eventLog) {
      eventLog.innerHTML =
        `<p class="text-green-400">[${new Date().toLocaleTimeString()}] Click event #${data.count}</p>` +
        eventLog.innerHTML;
    }
  });

  document.getElementById('emit-event')?.addEventListener('click', () => {
    clickCount++;
    emitter.emit('click', { count: clickCount });
  });

  // Notifications Demo
  document.getElementById('notify-success')?.addEventListener('click', () => {
    notify.success('Operation completed successfully!');
  });

  document.getElementById('notify-error')?.addEventListener('click', () => {
    notify.error('Something went wrong. Please try again.');
  });

  document.getElementById('notify-warning')?.addEventListener('click', () => {
    notify.warning('This action cannot be undone.');
  });

  document.getElementById('notify-info')?.addEventListener('click', () => {
    notify.info('Here is some helpful information.');
  });

  // Accessibility Demo
  document.getElementById('announce-polite')?.addEventListener('click', () => {
    announce('This is a polite announcement', 'polite');
  });

  document
    .getElementById('announce-assertive')
    ?.addEventListener('click', () => {
      announce('This is an assertive announcement!', 'assertive');
    });

  // Focus Trap Demo
  const focusTrapDemo = document.getElementById('focus-trap-demo');
  let focusTrap: ReturnType<typeof createFocusTrap> | null = null;
  let trapActive = false;

  document
    .getElementById('toggle-focus-trap')
    ?.addEventListener('click', () => {
      if (focusTrapDemo) {
        if (trapActive && focusTrap) {
          focusTrap.deactivate();
          focusTrap = null;
          trapActive = false;
          focusTrapDemo.classList.remove('border-green-500');
          focusTrapDemo.classList.add('border-zinc-700');
        } else {
          focusTrap = createFocusTrap(focusTrapDemo);
          focusTrap.activate();
          trapActive = true;
          focusTrapDemo.classList.remove('border-zinc-700');
          focusTrapDemo.classList.add('border-green-500');
        }
      }
    });

  // Media/Device Info
  function updateDeviceInfo() {
    const breakpoint = getCurrentBreakpoint();
    const viewport = getViewportSize();
    const mobile = isMobile();
    const touch = hasTouch();
    const orientation =
      window.innerWidth > window.innerHeight ? 'Landscape' : 'Portrait';
    const colorScheme = window.matchMedia('(prefers-color-scheme: dark)')
      .matches
      ? 'Dark'
      : 'Light';

    const els = {
      breakpoint: document.getElementById('breakpoint'),
      viewport: document.getElementById('viewport'),
      deviceType: document.getElementById('device-type'),
      touchSupport: document.getElementById('touch-support'),
      orientation: document.getElementById('orientation'),
      colorScheme: document.getElementById('color-scheme'),
    };

    if (els.breakpoint) els.breakpoint.textContent = breakpoint;
    if (els.viewport)
      els.viewport.textContent = `${viewport.width}x${viewport.height}`;
    if (els.deviceType)
      els.deviceType.textContent = mobile ? 'Mobile' : 'Desktop';
    if (els.touchSupport) els.touchSupport.textContent = touch ? 'Yes' : 'No';
    if (els.orientation) els.orientation.textContent = orientation;
    if (els.colorScheme) els.colorScheme.textContent = colorScheme;
  }

  updateDeviceInfo();
  window.addEventListener('resize', updateDeviceInfo);

  // Validation Demo
  const emailInput = document.getElementById(
    'validate-email'
  ) as HTMLInputElement;
  const phoneInput = document.getElementById(
    'validate-phone'
  ) as HTMLInputElement;
  const passwordInput = document.getElementById(
    'validate-password'
  ) as HTMLInputElement;

  emailInput?.addEventListener('input', () => {
    const result = emailSchema.safeParse(emailInput.value);
    const el = document.getElementById('email-result');
    if (el) {
      el.textContent = result.success ? '✓ Valid email' : '✗ Invalid email';
      el.className = `text-xs mt-1 ${result.success ? 'text-green-400' : 'text-red-400'}`;
    }
  });

  phoneInput?.addEventListener('input', () => {
    const result = phoneSchema.safeParse(phoneInput.value);
    const el = document.getElementById('phone-result');
    if (el) {
      el.textContent = result.success ? '✓ Valid phone' : '✗ Invalid phone';
      el.className = `text-xs mt-1 ${result.success ? 'text-green-400' : 'text-red-400'}`;
    }
  });

  passwordInput?.addEventListener('input', () => {
    const result = passwordSchema.safeParse(passwordInput.value);
    const el = document.getElementById('password-result');
    if (el) {
      if (result.success) {
        el.textContent = '✓ Strong password';
        el.className = 'text-xs mt-1 text-green-400';
      } else {
        const issues = result.error.issues.map(i => i.message).join(', ');
        el.textContent = `✗ ${issues}`;
        el.className = 'text-xs mt-1 text-red-400';
      }
    }
  });

  // Crypto Demo
  document.getElementById('generate-uuid')?.addEventListener('click', () => {
    const id = uuid();
    const el = document.getElementById('uuid-display');
    if (el) el.textContent = `UUID: ${id}`;
  });

  document
    .getElementById('generate-short-id')
    ?.addEventListener('click', () => {
      const id = shortId();
      const el = document.getElementById('uuid-display');
      if (el) el.textContent = `Short ID: ${id}`;
    });

  const hashInput = document.getElementById('hash-input') as HTMLInputElement;
  document.getElementById('hash-btn')?.addEventListener('click', async () => {
    const text = hashInput?.value || '';
    if (text) {
      const hash = await sha256(text);
      const el = document.getElementById('hash-display');
      if (el) el.textContent = hash;
    }
  });

  // HTTP Demo
  document.getElementById('fetch-demo')?.addEventListener('click', async () => {
    const el = document.getElementById('http-result');
    if (el) {
      el.textContent = 'Fetching...';
      try {
        const response = await get<{ title: string; body: string }>(
          'https://jsonplaceholder.typicode.com/posts/1'
        );
        el.textContent = JSON.stringify(response.data, null, 2);
      } catch (error) {
        el.textContent = `Error: ${error instanceof Error ? error.message : 'Unknown error'}`;
      }
    }
  });
</script>
