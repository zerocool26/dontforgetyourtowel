---
import MarketingLayout from '../layouts/MarketingLayout.astro';
import BottomNav from '../components/ui/BottomNav.astro';
import PullToRefresh from '../components/ui/PullToRefresh.astro';
import Skeleton from '../components/ui/Skeleton.astro';
import SkeletonCard from '../components/ui/SkeletonCard.astro';

const navItems = [
  { href: '/', label: 'Home', icon: 'üè†' },
  { href: '/services', label: 'Services', icon: '‚öôÔ∏è' },
  { href: '/about', label: 'Portfolio', icon: 'üëã' },
  { href: '/services#contact', label: 'Contact', icon: '‚úâÔ∏è' },
];
---

<MarketingLayout
  title="Mobile Features Demo"
  description="Showcase of Fortune 500-level mobile enhancements"
  showHeader={true}
  showFooter={false}
>
  <PullToRefresh />

  <div class="container mx-auto max-w-4xl px-4 py-12 pb-32">
    <header class="mb-12 text-center">
      <h1 class="mb-4 text-4xl font-bold text-gradient md:text-5xl">
        Mobile-First Enhancements
      </h1>
      <p class="text-lg text-slate-400">
        Fortune 500-level mobile UX features for your Astro site
      </p>
    </header>

    <!-- Performance Section -->
    <section class="glass-panel mb-8 p-8">
      <h2 class="mb-4 flex items-center gap-3 text-2xl font-bold">
        <span class="text-3xl">‚ö°</span>
        Performance Optimizations
      </h2>
      <div class="space-y-4">
        <div class="flex items-start gap-3">
          <span class="text-green-400">‚úì</span>
          <div>
            <h3 class="font-semibold">Code-Splitting</h3>
            <p class="text-sm text-slate-400">
              Three.js and heavy libraries dynamically imported (~150KB savings)
            </p>
          </div>
        </div>
        <div class="flex items-start gap-3">
          <span class="text-green-400">‚úì</span>
          <div>
            <h3 class="font-semibold">Font Preloading</h3>
            <p class="text-sm text-slate-400">
              Critical fonts preloaded for -200ms FCP improvement
            </p>
          </div>
        </div>
        <div class="flex items-start gap-3">
          <span class="text-green-400">‚úì</span>
          <div>
            <h3 class="font-semibold">DNS Prefetch</h3>
            <p class="text-sm text-slate-400">
              External resources prefetched for faster loading
            </p>
          </div>
        </div>
        <div class="flex items-start gap-3">
          <span class="text-green-400">‚úì</span>
          <div>
            <h3 class="font-semibold">Critical CSS Extraction</h3>
            <p class="text-sm text-slate-400">
              Above-the-fold styles inlined for instant render
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Loading States Section -->
    <section class="glass-panel mb-8 p-8">
      <h2 class="mb-4 flex items-center gap-3 text-2xl font-bold">
        <span class="text-3xl">‚è≥</span>
        Skeleton Loading States
      </h2>
      <p class="mb-6 text-slate-400">
        Professional loading placeholders improve perceived performance
      </p>

      <div class="space-y-6">
        <div>
          <h3 class="mb-3 text-sm font-semibold text-slate-300">
            Text Skeleton
          </h3>
          <Skeleton variant="text" lines={3} />
        </div>

        <div>
          <h3 class="mb-3 text-sm font-semibold text-slate-300">
            Card Skeleton
          </h3>
          <SkeletonCard hasImage={true} hasAvatar={true} lines={2} />
        </div>

        <div class="grid grid-cols-3 gap-4">
          <div>
            <h3 class="mb-3 text-sm font-semibold text-slate-300">Avatar</h3>
            <Skeleton variant="avatar" />
          </div>
          <div>
            <h3 class="mb-3 text-sm font-semibold text-slate-300">Button</h3>
            <Skeleton variant="button" width="100%" />
          </div>
          <div>
            <h3 class="mb-3 text-sm font-semibold text-slate-300">Circular</h3>
            <Skeleton variant="circular" width="48px" height="48px" />
          </div>
        </div>
      </div>
    </section>

    <!-- Mobile Interactions Section -->
    <section class="glass-panel mb-8 p-8">
      <h2 class="mb-4 flex items-center gap-3 text-2xl font-bold">
        <span class="text-3xl">üì±</span>
        Mobile Interactions
      </h2>

      <div class="space-y-6">
        <div>
          <h3 class="mb-2 font-semibold">Pull-to-Refresh</h3>
          <p class="mb-3 text-sm text-slate-400">
            Pull down from the top on mobile to refresh the page
          </p>
          <div class="rounded-lg bg-slate-800/50 p-4 font-mono text-sm">
            &lt;PullToRefresh /&gt;
          </div>
        </div>

        <div>
          <h3 class="mb-2 font-semibold">Swipe Gestures</h3>
          <p class="mb-3 text-sm text-slate-400">
            Gallery and carousel swipe navigation with haptic feedback
          </p>
          <div
            class="rounded-lg bg-gradient-to-r from-purple-900/50 to-blue-900/50 p-6 text-center"
            id="swipe-demo"
          >
            <p class="mb-2 text-2xl" id="swipe-text">üëà Swipe Me üëâ</p>
            <p class="text-sm text-slate-400" id="swipe-count">
              Swipe count: 0
            </p>
          </div>
        </div>

        <div>
          <h3 class="mb-2 font-semibold">Haptic Feedback</h3>
          <p class="mb-3 text-sm text-slate-400">
            Native-like vibration feedback on interactions
          </p>
          <div class="grid grid-cols-2 gap-3">
            <button
              class="rounded-lg bg-purple-600 font-semibold tap-target hover:bg-purple-700"
              data-haptic="light"
            >
              Light
            </button>
            <button
              class="rounded-lg bg-blue-600 font-semibold tap-target hover:bg-blue-700"
              data-haptic="medium"
            >
              Medium
            </button>
            <button
              class="rounded-lg bg-green-600 font-semibold tap-target hover:bg-green-700"
              data-haptic="success"
            >
              Success
            </button>
            <button
              class="rounded-lg bg-red-600 font-semibold tap-target hover:bg-red-700"
              data-haptic="error"
            >
              Error
            </button>
          </div>
        </div>

        <div>
          <h3 class="mb-2 font-semibold">Touch Targets (WCAG AAA)</h3>
          <p class="mb-3 text-sm text-slate-400">
            All interactive elements meet 48x48px minimum (Apple/Material
            guidelines)
          </p>
          <div class="flex flex-wrap gap-3">
            <button
              class="rounded-lg bg-indigo-600 px-6 tap-target hover:bg-indigo-700"
            >
              Standard
            </button>
            <button
              class="rounded-lg bg-indigo-600 px-4 tap-target-sm hover:bg-indigo-700"
            >
              Small (44px)
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Bottom Navigation Section -->
    <section class="glass-panel mb-8 p-8">
      <h2 class="mb-4 flex items-center gap-3 text-2xl font-bold">
        <span class="text-3xl">üß≠</span>
        Bottom Navigation
      </h2>
      <p class="mb-4 text-slate-400">
        Thumb-zone optimized navigation appears on mobile devices
      </p>
      <div class="rounded-lg bg-slate-800/50 p-4 text-sm">
        <p class="mb-2 font-semibold">Features:</p>
        <ul class="list-inside list-disc space-y-1 text-slate-300">
          <li>Fixed to bottom with safe-area support</li>
          <li>Haptic feedback on tap</li>
          <li>Active state indicators</li>
          <li>WCAG AAA touch targets (48px min)</li>
          <li>Smooth animations (respects reduced motion)</li>
        </ul>
      </div>
    </section>

    <!-- Developer Tools Section -->
    <section class="glass-panel p-8">
      <h2 class="mb-4 flex items-center gap-3 text-2xl font-bold">
        <span class="text-3xl">üõ†Ô∏è</span>
        Developer Tools
      </h2>
      <p class="mb-6 text-slate-400">
        Built-in utilities for development and debugging
      </p>

      <div class="space-y-4">
        <div class="rounded-lg bg-slate-800/50 p-4">
          <h3 class="mb-2 font-semibold">Touch Target Validator</h3>
          <p class="mb-3 text-sm text-slate-400">
            Automatically validates all interactive elements
          </p>
          <button
            class="rounded-lg bg-cyan-600 px-6 font-semibold tap-target hover:bg-cyan-700"
            onclick="window.validateTouchTargets()"
          >
            Run Validation
          </button>
        </div>

        <div class="rounded-lg bg-slate-800/50 p-4">
          <h3 class="mb-2 font-semibold">Critical CSS Extractor</h3>
          <p class="text-sm text-slate-400">
            Extract above-the-fold CSS for performance optimization
          </p>
        </div>

        <div class="rounded-lg bg-slate-800/50 p-4">
          <h3 class="mb-2 font-semibold">Haptic Test Suite</h3>
          <p class="text-sm text-slate-400">
            Test different haptic patterns (buttons above)
          </p>
        </div>
      </div>
    </section>
  </div>

  <!-- Bottom Navigation (only shows on mobile) -->
  <BottomNav items={navItems} />
</MarketingLayout>

<script>
  import { setupGallerySwipe } from '../utils/swipe-gestures';
  import { initAllHaptics } from '../utils/haptic';
  import {
    initTouchTargetValidation,
    reportTouchTargetIssues,
    validateAllTouchTargets,
  } from '../utils/touch-target-validator';

  // Initialize haptic feedback
  initAllHaptics();

  // Initialize touch target validation in dev mode
  initTouchTargetValidation({ logToConsole: true, autoFix: false });

  // Swipe gesture demo
  let swipeCount = 0;
  const swipeDemo = document.getElementById('swipe-demo');
  const swipeText = document.getElementById('swipe-text');
  const swipeCountEl = document.getElementById('swipe-count');

  if (swipeDemo && swipeText && swipeCountEl) {
    setupGallerySwipe(
      swipeDemo,
      () => {
        swipeCount++;
        swipeText.textContent = 'üëà Swiped Left!';
        swipeCountEl.textContent = `Swipe count: ${swipeCount}`;
        setTimeout(() => {
          swipeText.textContent = 'üëà Swipe Me üëâ';
        }, 1000);
      },
      () => {
        swipeCount++;
        swipeText.textContent = 'üëâ Swiped Right!';
        swipeCountEl.textContent = `Swipe count: ${swipeCount}`;
        setTimeout(() => {
          swipeText.textContent = 'üëà Swipe Me üëâ';
        }, 1000);
      }
    );
  }

  // Expose validation function to window for button
  (window as any).validateTouchTargets = () => {
    const issues = validateAllTouchTargets();
    reportTouchTargetIssues(issues);
  };
</script>

<style>
  #swipe-demo {
    touch-action: pan-y;
    user-select: none;
    -webkit-user-select: none;
    cursor: grab;
    transition: transform 0.3s ease;
  }

  #swipe-demo:active {
    cursor: grabbing;
  }
</style>
